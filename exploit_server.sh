echo "Running DATE:" $(date +"%Y-%m-%d %H:%M")

DATE=`date '+%Y%m%d_%H%M'`
echo "Save as: " $DATE

# declare -a envs=('slimevolley_SlimeVolley-v0' 'pettingzoo_boxing_v1' 'pettingzoo_pong_v2' 'pettingzoo_surround_v1' 'pettingzoo_tennis_v2' 'pettingzoo_ice_hockey_v1')
declare -a envs=('slimevolley_SlimeVolley-v0' 'pettingzoo_boxing_v1' 'pettingzoo_pong_v2' 'pettingzoo_surround_v1' 'pettingzoo_tennis_v2' 'pettingzoo_double_dunk_v2')

# declare -a methods=('selfplay2' 'fictitious_selfplay2' 'nxdo2' 'nfsp' 'nash_dqn' 'nash_dqn_exploiter' 'nash_ppo')
declare -a methods=('nash_ppo')

# LoadFrom='20220115_0159'
# mkdir -p log/exploit_$LoadFrom

# declare -a idx=('20220119_0521' '20220119_0524' '20220119_0526')
# declare -a idx=('20220119_1543' '20220119_1545' '20220119_1551')
declare -a idx=('20220412_1700')


for k in ${!idx[@]}; do
    echo mkdir -p log/exploit_${idx[$k]}
    mkdir -p log/exploit_${idx[$k]}
done

for k in ${!idx[@]}; do
    for i in ${!envs[@]}; do
        for j in ${!methods[@]}; do

            if [ $j -gt 3 ]
            then 
            echo CUDA_VISIBLE_DEVICES=0 python general_exploit.py --env ${envs[$i]} --method ${methods[$j]} --load_id ${idx[$k]} --save_id exploit_${idx[$k]} output log to: log/exploit_${idx[$k]}/${envs[$i]}_${methods[$j]}.log &
            CUDA_VISIBLE_DEVICES=0 nohup python general_exploit.py --env ${envs[$i]} --method ${methods[$j]} --load_id ${idx[$k]} --save_id exploit_${idx[$k]} >> log/exploit_${idx[$k]}/${envs[$i]}_${methods[$j]}.log &

            else
            echo CUDA_VISIBLE_DEVICES=1 python general_exploit.py --env ${envs[$i]} --method ${methods[$j]} --load_id ${idx[$k]} --save_id exploit_${idx[$k]} output log to: log/exploit_${idx[$k]}/${envs[$i]}_${methods[$j]}.log &
            CUDA_VISIBLE_DEVICES=1 nohup python general_exploit.py --env ${envs[$i]} --method ${methods[$j]} --load_id ${idx[$k]} --save_id exploit_${idx[$k]} >> log/exploit_${idx[$k]}/${envs[$i]}_${methods[$j]}.log &
            
            # echo CUDA_VISIBLE_DEVICES=$j python general_exploit.py --env ${envs[$i]} --method ${methods[$j]} --load_id ${idx[$k]} --save_id exploit_${idx[$k]} output log to: log/exploit_${idx[$k]}/${envs[$i]}_${methods[$j]}.log &
            # CUDA_VISIBLE_DEVICES=$j nohup python general_exploit.py --env ${envs[$i]} --method ${methods[$j]} --load_id ${idx[$k]} --save_id exploit_${idx[$k]} >> log/exploit_${idx[$k]}/${envs[$i]}_${methods[$j]}.log &
            fi
        done
    done
done
