echo "Running DATE:" $(date +"%Y-%m-%d %H:%M")

DATE=`date '+%Y%m%d_%H%M'`
echo "Save as: " $DATE

# declare -a envs=('pettingzoo_pong_v3')
declare -a envs=('pettingzoo_boxing_v2')

# declare -a methods=('selfplay' 'fictitious_selfplay' 'psro')
# declare -a methods=('nash_dqn' 'nash_dqn_exploiter')
declare -a methods=('nash_dqn_exploiter')
declare -a times=('1')  # exploit each model three times

# LoadFrom='20221010_1938'  # load a trained model by index
# LoadFrom='20221217_1917'
LoadFrom='20230112_2124'

declare -a ToExploit=('first')  # 'first' or 'second' side to exploit

for t in ${times[@]}; do
    mkdir -p log/exploit_first_${t}_${LoadFrom} &
    # mkdir -p log/exploit_second_${t}_${LoadFrom} &
    
    for k in ${!ToExploit[@]}; do
        for i in ${!envs[@]}; do
            for j in ${!methods[@]}; do
                echo CUDA_VISIBLE_DEVICES=$((j + 2)) python general_exploit.py --env ${envs[$i]} --method ${methods[$j]} --load_id $LoadFrom --save_id $DATE --to_exploit ${ToExploit[$k]}_${t} --wandb_activate True --wandb_entity quantumiracle output log to: log/exploit_${ToExploit[$k]}_${t}_${LoadFrom}/${envs[$i]}_${methods[$j]}.log &
                CUDA_VISIBLE_DEVICES=$((j + 2)) nohup python general_exploit.py --env ${envs[$i]} --method ${methods[$j]} --load_id $LoadFrom --save_id $DATE --to_exploit ${ToExploit[$k]}_${t} --wandb_activate True --wandb_entity quantumiracle >> log/exploit_${ToExploit[$k]}_${t}_${LoadFrom}/${envs[$i]}_${methods[$j]}.log &
            done
        done
    done
done
